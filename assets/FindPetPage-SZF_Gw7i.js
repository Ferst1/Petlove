import{u as b,a as j,r as x,j as e,A as $,m as I,I as M,B as N,b as se,c as te,d as ae,e as ne,f as oe,g as le,s as T,h as B,i as G,k as R,l as _,n as ce,o as ie,p as re,q as A,t as de}from"./index-DaBnxrT0.js";import{S as P,P as he}from"./PetCard-QRA71RUy.js";import{S as O,R as z,T as ue}from"./TypeSelect-CAw9y02J.js";import{I as D,P as pe}from"./Pagination-BuLhTesS.js";import"./hoist-non-react-statics.cjs-BM6HcED4.js";const F="/Petlove/images/star-transparent.png",me="/Petlove/images/heard-white.png",K=({children:r,isOpen:c,onClose:d,pet:a})=>{const n=b(),y=j(s=>s.favoritePets.pets),m=a?y.some(s=>s._id===a._id):!1,o={hidden:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:{duration:.5,ease:"easeInOut"}},exit:{opacity:0,scale:.8,transition:{duration:.3,ease:"easeInOut"}}},l=s=>{s.key==="Escape"&&d()},h=s=>{s.target===s.currentTarget&&d()},t=()=>{n(m?se(a):te(a))};return x.useLayoutEffect(()=>(document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}),[]),x.useLayoutEffect(()=>{c?document.body.style.overflow="hidden":document.body.style.overflow="unset"},[c]),e.jsx($,{children:c&&a&&e.jsx("div",{className:"backdrop",onClick:h,children:e.jsx(I.div,{className:"modal-window",initial:"hidden",animate:"visible",exit:"exit",variants:o,children:e.jsx("div",{className:"modal-content",children:e.jsxs("div",{className:"pet-info",children:[e.jsx("button",{className:"close-btn",onClick:d,children:e.jsx(M,{size:"24px"})}),e.jsx("img",{src:a.imgURL,alt:a.title}),e.jsx("p",{className:"category_modal",children:a.category}),e.jsx("h2",{children:a.title}),e.jsxs("div",{className:"name-rating",children:[e.jsx("img",{className:"star",src:P}),e.jsx("img",{className:"star",src:P}),e.jsx("img",{className:"star",src:P}),e.jsx("img",{className:"star",src:F}),e.jsx("img",{className:"star",src:F}),e.jsx("p",{children:a.popularity})]}),e.jsxs("div",{className:"info_item",children:[e.jsxs("p",{children:[e.jsx("div",{className:"label",children:"Name:"})," ",a.name]}),e.jsxs("p",{children:[e.jsx("div",{className:"label",children:"Birthday:"})," ",a.birthday]}),e.jsxs("p",{children:[e.jsx("div",{className:"label",children:"Sex:"})," ",a.sex]}),e.jsxs("p",{children:[e.jsx("div",{className:"label",children:"Species:"})," ",a.species]})]}),e.jsx("p",{className:"comment",children:a.comment}),e.jsxs("div",{className:"buttons_modal",children:[e.jsx(N,{text:m?"Remove from favorites":"Add to favorites",className:"primary",onClick:t,children:e.jsx("img",{src:me,alt:"Heart",className:"button-icon"})}),e.jsx(N,{text:"Contact",className:"primary"})]})]})})})})})},xe="/Petlove/assets/avatar-atantion-BZf1xWKu.png",Q=({isOpen:r,onClose:c})=>{ae();const d=n=>{n.key==="Escape"&&c()},a=n=>{n.target===n.currentTarget&&c()};return x.useLayoutEffect(()=>(document.addEventListener("keydown",d),()=>{document.removeEventListener("keydown",d)}),[]),x.useLayoutEffect(()=>{r?document.body.style.overflow="hidden":document.body.style.overflow="unset"},[r]),e.jsx($,{children:r&&e.jsx("div",{className:"backdrop",onClick:a,children:e.jsx(I.div,{"data-aos":"fade-up","data-aos-delay":"100",className:"modal-window",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{className:"close-btn",onClick:c,children:e.jsx(M,{size:"24px"})}),e.jsx("img",{src:xe,alt:"avatar pet"}),e.jsx("h3",{children:"Attention"}),e.jsx("p",{children:"We would like to remind you that certain functionality is available only to authorized users. If you have an account, please log in with your credentials. If you do not already have an account, you must register to access these features."}),e.jsx("div",{className:"buttons_modal",children:e.jsx(ne,{})})]})})})})},fe=({pets:r,loading:c,onPetClick:d})=>{const[a,n]=x.useState(null),[y,m]=x.useState(!1),o=b(),{user:l}=j(s=>s.user),h=s=>{l?(n(s),o(oe(s))):m(!0)},t=()=>{n(null),m(!1)};return x.useEffect(()=>{console.log("Displaying pets:",r)},[r]),e.jsxs("div",{className:"find_pets_card_wrapper",children:[e.jsx("div",{className:"find_pets_card",children:c?e.jsx("p",{children:"Loading..."}):r.map((s,f)=>e.jsx("div",{"data-aos":"fade-up","data-aos-delay":`${f*100}`,children:e.jsx(he,{pet:s,openModal:h})},s._id))}),a&&e.jsxs(K,{isOpen:a!==null,onClose:t,pet:a,children:[e.jsx("h2",{children:a.title}),e.jsx("button",{onClick:t,children:"Close Modal"})]}),e.jsx(Q,{isOpen:y,onClose:t})]})},ge=["found","free","lost","sell"],ye=({onChange:r})=>{const[c,d]=x.useState(null),a=n=>{d(n),r(n?n.value:"")};return e.jsx(O,{value:c,onChange:a,options:ge.map(n=>({value:n,label:n})),isSearchable:!0,placeholder:"Category",isClearable:!0,styles:z})},je=["female","male","multiple","unknown"],Ce=({onChange:r})=>{const[c,d]=x.useState(null),a=n=>{d(n),r(n?n.value:"")};return e.jsx(O,{value:c,onChange:a,options:je.map(n=>({value:n,label:n})),isSearchable:!0,placeholder:"By gender",isClearable:!0,styles:z})},ve=({onChange:r})=>{const[c,d]=x.useState([]),[a,n]=x.useState([]);x.useEffect(()=>{(async()=>{try{const h=await le.get("/api/locations");я;const t=h.data.map(s=>({value:`${s.stateEn} ${s.cityEn} ${s.countyEn}`,label:`${s.stateEn}, ${s.cityEn} (${s.countyEn})`}));d(t),n(t)}catch(h){console.error("Error fetching locations:",h)}})()},[]);const y=l=>{const h=c.filter(t=>t.label.toLowerCase().includes(l.toLowerCase()));n(h),r(l)},m=()=>{n(c),r("")},o=l=>{n([]),r(l.value)};return e.jsxs("div",{children:[e.jsx(D,{onSearch:y,onClear:m}),a.length>0&&e.jsx("ul",{className:"dropdown-menu",children:a.map((l,h)=>e.jsx("li",{onClick:()=>o(l),className:"dropdown-item",children:l.label},h))})]})},we=({categories:r,genders:c,types:d,locations:a,onSearch:n,onClear:y,onCategoryChange:m,onGenderChange:o,onTypeChange:l,onLocationChange:h})=>{const[t,s]=x.useState(""),f=b(),C=p=>{f(T(p)),m(p)},v=p=>{f(B(p)),o(p)},w=p=>{f(G(p)),l(p)},u=p=>{f(R(p)),h(p)},g=p=>{t===p?(s(""),f(_(""))):(s(p),f(_(p)))};return e.jsxs("div",{className:"search_wrapper",children:[e.jsx(D,{onSearch:n,onClear:y}),e.jsxs("div",{className:"search_field_form",children:[e.jsx(ye,{onChange:C,categories:r,className:"custom-dropdown"}),e.jsx(Ce,{onChange:v,genders:c,className:"custom-dropdown"}),e.jsx(ue,{placeholder:"Type of",onChange:w,types:d,className:"custom-dropdown"}),e.jsx(ve,{onChange:u,locations:a,className:"custom-dropdown"})]}),e.jsxs("div",{className:"radio_button",children:[e.jsx(N,{text:"Popular",color:"white",isActive:t==="popularity",onClick:()=>g("popularity"),isClearable:t==="popularity",onClear:()=>g("popularity")}),e.jsx(N,{text:"Unpopular",color:"white",isActive:t==="unpopularity",onClick:()=>g("unpopularity"),isClearable:t==="unpopularity",onClear:()=>g("unpopularity")}),e.jsx(N,{text:"Cheap",color:"white",isActive:t==="cheap",onClick:()=>g("cheap"),isClearable:t==="cheap",onClear:()=>g("cheap")}),e.jsx(N,{text:"Expensive",color:"white",isActive:t==="expensive",onClick:()=>g("expensive"),isClearable:t==="expensive",onClear:()=>g("expensive")})]})]})},Ne=(r,c,d,a,n,y,m)=>{console.log("Filtering pets with: ",{query:c,category:d,gender:a,type:n,location:y,sortBy:m});let o=r;const l=c.toLowerCase(),h=y.toLowerCase();return c&&(o=o.filter(t=>{const{species:s,title:f,name:C,comment:v,sex:w,location:u}=t,g=`${(u==null?void 0:u.stateEn)||""} ${(u==null?void 0:u.cityEn)||""}`.toLowerCase();return s&&s.toLowerCase().includes(l)||f&&f.toLowerCase().includes(l)||C&&C.toLowerCase().includes(l)||v&&v.toLowerCase().includes(l)||w&&w.toLowerCase().includes(l)||g.includes(l)})),d&&(o=o.filter(t=>t.category===d)),a&&(o=o.filter(t=>t.sex===a)),n&&(o=o.filter(t=>t.species===n)),y&&(o=o.filter(t=>{const s=t.location;if(s&&s.stateEn&&s.cityEn){const f=`${s.stateEn}, ${s.cityEn}`.toLowerCase();return console.log(`Comparing locationString: "${f}" with lowerCaseLocation: "${h}"`),f.includes(h)}else return console.log("Missing or incomplete location data for pet:",t),!1})),m==="popularity"?o=o.slice().sort((t,s)=>s.popularity-t.popularity):m==="unpopularity"?o=o.slice().sort((t,s)=>t.popularity-s.popularity):m==="cheap"?o=o.slice().sort((t,s)=>t.price-s.price):m==="expensive"&&(o=o.slice().sort((t,s)=>s.price-t.price)),console.log("Filtered pets result: ",o),o},ke=()=>{const{categories:r,genders:c,types:d,locations:a,loading:n,error:y}=j(i=>i.data),{pets:m,totalItems:o,query:l,currentPage:h}=j(i=>i.search),{category:t,gender:s,type:f,location:C}=j(i=>i.filters),{sortBy:v}=j(i=>i.sort),{user:w}=j(i=>i.user),u=b(),g=6,[p,E]=x.useState(!1),[H,L]=x.useState(null);x.useEffect(()=>{ce.init(),u(ie({query:l})),u(re())},[u,l]);const U=i=>{u(A(i))},V=()=>{u(A(""))},W=i=>{u(de(i))},Z=i=>{u(T(i))},J=i=>{u(B(i))},X=i=>{u(G(i))},Y=i=>{console.log("Selected location: ",i),u(R(i))},q=i=>{L(i),E(!0)},k=()=>{E(!1),L(null)},S=Ne(m,l,t,s,f,C,v),ee=S.slice((h-1)*g,h*g);return x.useEffect(()=>{console.log("Filtered pets: ",S)},[S]),e.jsxs("div",{className:"container",children:[e.jsxs("section",{className:"find_yor_pets",children:[e.jsx("h2",{children:"Find your favorite pet"}),e.jsx("div",{className:"find_pets_container",children:e.jsx(we,{categories:r,genders:c,types:d,locations:a,onSearch:U,onClear:V,onCategoryChange:Z,onGenderChange:J,onTypeChange:X,onLocationChange:Y})}),e.jsx("div",{className:"pets_section",children:e.jsx(fe,{pets:ee,loading:n,onPetClick:q})}),e.jsx(pe,{totalItems:S.length,itemsPerPage:g,onPageChange:W,currentPage:h})]}),w?e.jsx(K,{isOpen:p,onClose:k,pet:H}):e.jsx(Q,{isOpen:p,onClose:k})]})};export{ke as default};
